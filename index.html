<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake Solana P2E</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        body { 
            background-color: #8b9d5c; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; height: 100vh; margin: 0; 
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
        }
        
        #score-board { 
            font-size: 22px; font-weight: bold; color: #333; 
            margin-bottom: 5px; width: 240px; display: flex; justify-content: space-between;
        }

        .grid { 
            width: 240px; height: 240px; 
            background-color: #9bbc0f; 
            border: 6px solid #333; 
            display: flex; flex-wrap: wrap; 
        }
        .grid div { width: 24px; height: 24px; box-sizing: border-box; }
        .snake { background-color: #000; border: 1px solid #9bbc0f; }
        .apple { background-color: #000; border-radius: 50%; }

        /* Kontrol D-Pad */
        .controls {
            margin-top: 20px;
            display: grid;
            grid-template-areas: 
                ". up ."
                "left down right";
            gap: 12px;
        }
        .btn {
            width: 65px; height: 65px;
            background: #333; color: #9bbc0f;
            border: none; border-radius: 50%;
            font-weight: bold; font-size: 22px;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 5px #222;
        }
        .btn:active { box-shadow: 0 0 #222; transform: translateY(4px); }
        .up { grid-area: up; }
        .left { grid-area: left; }
        .down { grid-area: down; }
        .right { grid-area: right; }

        #wallet-section { margin-top: 15px; text-align: center; }
        button#connectBtn { 
            background: #333; color: #9bbc0f; border: none; 
            padding: 10px 20px; font-weight: bold; border-radius: 5px;
            cursor: pointer;
        }
        .token-info { font-size: 12px; color: #333; margin-top: 5px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="score-board">
        <span>Score: <span id="score">0</span></span>
        <span style="color: #701313;">Life: 1</span>
    </div>
    
    <div class="grid"></div>

    <div class="controls">
        <button class="btn up" onclick="changeDir('UP')">▲</button>
        <button class="btn left" onclick="changeDir('LEFT')">◀</button>
        <button class="btn down" onclick="changeDir('DOWN')">▼</button>
        <button class="btn right" onclick="changeDir('RIGHT')">▶</button>
    </div>

    <div id="wallet-section">
        <button id="connectBtn" onclick="connectWallet()">CONNECT WALLET</button>
        <div class="token-info">My Token: <span id="tokenBalance">0.00</span> $SNACK</div>
    </div>

    <script>
        // --- KONFIGURASI ---
        const MINT_ADDRESS = "GANTI_DENGAN_MINT_ADDRESS_TOKEN_ANDA"; // Masukkan alamat token anda di sini nanti
        const grid = document.querySelector('.grid');
        const tokenDisplay = document.getElementById('tokenBalance');
        const scoreDisplay = document.getElementById('score');
        const connectBtn = document.getElementById('connectBtn');
        
        let squares = [];
        let snake = [2, 1, 0];
        let appleIndex = 0;
        let direction = 1;
        const width = 10;
        let score = 0;
        let intervalTime = 400; 
        let interval = 0;
        let userWallet = null;

        // --- KONEKSI SOLANA & SPL TOKEN ---
        async function connectWallet() {
            if ("solana" in window) {
                try {
                    const resp = await window.solana.connect();
                    userWallet = resp.publicKey;
                    connectBtn.innerText = "WALLET CONNECTED";
                    updateTokenBalance();
                } catch (err) { console.error("User menolak koneksi"); }
            } else {
                alert("Harap buka di browser aplikasi Phantom/Solflare!");
            }
        }

        async function updateTokenBalance() {
            if (!userWallet || MINT_ADDRESS === "GANTI_DENGAN_MINT_ADDRESS_TOKEN_ANDA") return;
            
            const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));
            try {
                const tokenAccounts = await connection.getParsedTokenAccountsByOwner(userWallet, {
                    mint: new solanaWeb3.PublicKey(MINT_ADDRESS)
                });

                if (tokenAccounts.value.length > 0) {
                    const amount = tokenAccounts.value[0].account.data.parsed.info.tokenAmount.uiAmount;
                    tokenDisplay.innerText = amount.toFixed(2);
                }
            } catch (err) { console.error("Gagal mengambil balance token"); }
        }

        // --- LOGIK GAME ---
        function createGrid() {
            for (let i = 0; i < 100; i++) {
                const square = document.createElement('div');
                grid.appendChild(square);
                squares.push(square);
            }
        }
        createGrid();

        function draw() {
            squares.forEach(sq => sq.classList.remove('snake'));
            snake.forEach(index => squares[index].classList.add('snake'));
        }

        function move() {
            // Logik Mati (1 Nyawa)
            if (
                (snake[0] + width >= 100 && direction === width) || 
                (snake[0] % width === width - 1 && direction === 1) || 
                (snake[0] % width === 0 && direction === -1) || 
                (snake[0] - width < 0 && direction === -width) || 
                squares[snake[0] + direction].classList.contains('snake')
            ) {
                alert("GAME OVER! Token Nyawa Berkurang 1");
                return location.reload(); 
            }

            const tail = snake.pop();
            squares[tail].classList.remove('snake');
            snake.unshift(snake[0] + direction);
            
            // Logik Makan (1 Token 1 Makan)
            if (squares[snake[0]].classList.contains('apple')) {
                squares[snake[0]].classList.remove('apple');
                squares[tail].classList.add('snake');
                snake.push(tail);
                score++;
                scoreDisplay.innerText = score;
                generateApple();
            }
            draw();
        }

        function generateApple() {
            do {
                appleIndex = Math.floor(Math.random() * squares.length);
            } while (squares[appleIndex].classList.contains('snake'));
            squares[appleIndex].classList.add('apple');
        }
        generateApple();

        function changeDir(move) {
            if (move === 'UP' && direction !== width) direction = -width;
            if (move === 'DOWN' && direction !== -width) direction = width;
            if (move === 'LEFT' && direction !== 1) direction = -1;
            if (move === 'RIGHT' && direction !== -1) direction = 1;
        }

        // Mulai Game
        interval = setInterval(move, intervalTime);
    </script>
</body>
</html>
