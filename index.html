<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake Solana - With Sound</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        body { background-color: #8b9d5c; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; font-family: monospace; overflow: hidden; }
        #score-board { font-size: 22px; font-weight: bold; color: #333; margin-bottom: 5px; width: 240px; display: flex; justify-content: space-between; }
        .grid { width: 240px; height: 240px; background-color: #9bbc0f; border: 6px solid #333; display: flex; flex-wrap: wrap; }
        .grid div { width: 24px; height: 24px; box-sizing: border-box; }
        .snake { background-color: #000; border: 1px solid #9bbc0f; }
        .apple { background-color: #000; border-radius: 50%; }
        .controls { margin-top: 20px; display: grid; grid-template-areas: ". up ." "left down right"; gap: 12px; }
        .btn { width: 65px; height: 65px; background: #333; color: #9bbc0f; border: none; border-radius: 50%; font-weight: bold; font-size: 22px; display: flex; justify-content: center; align-items: center; box-shadow: 0 5px #222; }
        .btn:active { box-shadow: 0 0 #222; transform: translateY(4px); }
        .up { grid-area: up; } .left { grid-area: left; } .down { grid-area: down; } .right { grid-area: right; }
        #wallet-section { margin-top: 15px; text-align: center; }
        button#connectBtn { background: #333; color: #9bbc0f; border: none; padding: 10px 20px; font-weight: bold; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="score-board">
        <span>Score: <span id="score">0</span></span>
        <span style="color: #701313;">Life: 1</span>
    </div>
    
    <div class="grid"></div>

    <div class="controls">
        <button class="btn up" onclick="changeDir('UP')">▲</button>
        <button class="btn left" onclick="changeDir('LEFT')">◀</button>
        <button class="btn down" onclick="changeDir('DOWN')">▼</button>
        <button class="btn right" onclick="changeDir('RIGHT')">▶</button>
    </div>

    <div id="wallet-section">
        <button id="connectBtn" onclick="connectWallet()">CONNECT WALLET</button>
        <div style="font-size: 11px; margin-top: 5px;">My Token: <span id="tokenBalance">0.00</span> $SNACK</div>
    </div>

    <script>
        // --- SISTEM SUARA (WEB AUDIO API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playEatSound() {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'square'; // Suara retro nokia
            oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);
        }

        // --- KONFIGURASI GAME ---
        const MINT_ADDRESS = "GANTI_DENGAN_MINT_ADDRESS_TOKEN_ANDA";
        const grid = document.querySelector('.grid');
        const scoreDisplay = document.getElementById('score');
        
        let squares = [];
        let snake = [2, 1, 0];
        let appleIndex = 0;
        let direction = 1;
        const width = 10;
        let score = 0;
        let intervalTime = 400; 
        let interval = 0;

        // --- CREATE GRID ---
        function createGrid() {
            for (let i = 0; i < 100; i++) {
                const square = document.createElement('div');
                grid.appendChild(square);
                squares.push(square);
            }
        }
        createGrid();

        function draw() {
            squares.forEach(sq => sq.classList.remove('snake'));
            snake.forEach(index => squares[index].classList.add('snake'));
        }

        function move() {
            if (
                (snake[0] + width >= 100 && direction === width) || 
                (snake[0] % width === width - 1 && direction === 1) || 
                (snake[0] % width === 0 && direction === -1) || 
                (snake[0] - width < 0 && direction === -width) || 
                squares[snake[0] + direction].classList.contains('snake')
            ) {
                alert("GAME OVER! Skor: " + score);
                return location.reload();
            }

            const tail = snake.pop();
            squares[tail].classList.remove('snake');
            snake.unshift(snake[0] + direction);
            
            // LOGIK MAKAN + SUARA
            if (squares[snake[0]].classList.contains('apple')) {
                squares[snake[0]].classList.remove('apple');
                squares[tail].classList.add('snake');
                snake.push(tail);
                score++;
                scoreDisplay.innerText = score;
                playEatSound(); // Panggil suara di sini
                generateApple();
            }
            draw();
        }

        function generateApple() {
            do {
                appleIndex = Math.floor(Math.random() * squares.length);
            } while (squares[appleIndex].classList.contains('snake'));
            squares[appleIndex].classList.add('apple');
        }
        generateApple();

        function changeDir(move) {
            // Aktifkan Audio Context (Wajib untuk Chrome Android)
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            if (move === 'UP' && direction !== width) direction = -width;
            if (move === 'DOWN' && direction !== -width) direction = width;
            if (move === 'LEFT' && direction !== 1) direction = -1;
            if (move === 'RIGHT' && direction !== -1) direction = 1;
        }

        interval = setInterval(move, intervalTime);

        // Solana Wallet Function (Simpel)
        async function connectWallet() {
            if ("solana" in window) {
                const resp = await window.solana.connect();
                document.getElementById('connectBtn').innerText = "CONNECTED";
            } else { alert("Gunakan Phantom Browser!"); }
        }
    </script>
</body>
</html>

